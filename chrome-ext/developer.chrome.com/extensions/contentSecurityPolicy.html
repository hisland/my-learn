<!DOCTYPE html>
<html>
  <head>
    <title>Content Security Policy (CSP) - Google Chrome</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="../static/css/site.css" rel="stylesheet" type="text/css">
    <link href="../static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41980257-1');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="gc-topnav">
      <table><tr>
      <td id="chrome-logo">
        <a href="index.html" title="Google Chrome Extensions">
          <img src="../static/images/chrome-logo.png" alt=""> chrome
        </a>
        <div id="platform-chooser">
          <button id="platform-chooser-toggle" data-menu="platform-chooser-popup">
            extensions &#x25be;&#x202F;
          </button>
          <div id="platform-chooser-popup">
            <button class="apps" data-href="/apps/about_apps.html">apps</button>
            <button class="extensions" data-href="/extensions">extensions</button>
          </div>
        </div>
      </td>
      <td>
        <ul>
          <li>
            <a href="samples.html"
               title="Sample Extensions (with source code)">Samples</a>
          </li>
          <li>
            <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions"
               title="Google Chrome Extensions developer forum"
               target="_blank">Group</a>
          </li>
          <li>
            <a href="http://stackoverflow.com/tags/google-chrome-extension/info"
               title="[google-chrome-extension] tag on Stack Overflow"
               target="_blank">Stack overflow</a>
          </li>
        </ul>
      </td>
      </tr></table>
    </div>
    <div id="gc-topnav-space"></div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
        <li class="level2">
              <a href="getstarted.html" class="level2 ">Getting Started</a>
        </li><li class="level2">
              <a href="overview.html" class="level2 ">Overview</a>
        </li><li class="level2">
              <a href="whats_new.html" class="level2 ">What's New?</a>
        </li><li class="level2">
              <a href="devguide.html" class="level2 ">Developer's Guide</a>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">Browser UI</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="browserAction.html" class="level4 ">Browser Actions</a>
            </li><li class="level4">
                  <a href="contextMenus.html" class="level4 ">Context Menus</a>
            </li><li class="level4">
                  <a href="desktop_notifications.html" class="level4 ">Desktop Notifications</a>
            </li><li class="level4">
                  <a href="omnibox.html" class="level4 ">Omnibox</a>
            </li><li class="level4">
                  <a href="options.html" class="level4 ">Options Pages</a>
            </li><li class="level4">
                  <a href="override.html" class="level4 ">Override Pages</a>
            </li><li class="level4">
                  <a href="pageAction.html" class="level4 ">Page Actions</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Browser Interaction</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="bookmarks.html" class="level4 ">Bookmarks</a>
            </li><li class="level4">
                  <a href="cookies.html" class="level4 ">Cookies</a>
            </li><li class="level4">
                  <a href="devtools.html" class="level4 ">Extending DevTools</a>
            </li><li class="level4">
                  <a href="events.html" class="level4 ">Events</a>
            </li><li class="level4">
                  <a href="history.html" class="level4 ">History</a>
            </li><li class="level4">
                  <a href="management.html" class="level4 ">Management</a>
            </li><li class="level4">
                  <a href="tabs.html" class="level4 ">Tabs</a>
            </li><li class="level4">
                  <a href="windows.html" class="level4 ">Windows</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Implementation</span>
                <div class="toggleIndicator level3 toggled"></div>
              </a>
            <ul toggleable
                class="level3 ">
            <li class="level4">
                  <a href="a11y.html" class="level4 ">Accessibility</a>
            </li><li class="level4">
                  <a href="event_pages.html" class="level4 ">Event Pages</a>
            </li><li class="level4">
                  <a  class="level4 selected">Content Security Policy</a>
            </li><li class="level4">
                  <a href="content_scripts.html" class="level4 ">Content Scripts</a>
            </li><li class="level4">
                  <a href="xhr.html" class="level4 ">Cross-Origin XHR</a>
            </li><li class="level4">
                  <a href="i18n.html" class="level4 ">Internationalization</a>
            </li><li class="level4">
                  <a href="messaging.html" class="level4 ">Message Passing</a>
            </li><li class="level4">
                  <a href="permissions.html" class="level4 ">Optional Permissions</a>
            </li><li class="level4">
                  <a href="npapi.html" class="level4 ">NPAPI Plugins</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Finishing</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="hosting.html" class="level4 ">Hosting</a>
            </li><li class="level4">
                  <a href="external_extensions.html" class="level4 ">Other Deployment Options</a>
            </li>
            </ul>
          </li>
          </ul>
        </li><li class="level2">
              <a href="tutorials.html" class="level2 ">Tutorials</a>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="tut_migration_to_manifest_v2.html" class="level3 ">Manifest V2</a>
          </li><li class="level3">
                <a href="tut_debugging.html" class="level3 ">Debugging</a>
          </li><li class="level3">
                <a href="tut_analytics.html" class="level3 ">Google Analytics</a>
          </li><li class="level3">
                <a href="tut_oauth.html" class="level3 ">OAuth</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Reference</span>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">Formats</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="manifest.html" class="level4 ">Manifest Files</a>
            </li><li class="level4">
                  <a href="match_patterns.html" class="level4 ">Match Patterns</a>
            </li>
            </ul>
          </li><li class="level3">
                <a href="permission_warnings.html" class="level3 ">Permission Warnings</a>
          </li><li class="level3">
                <a href="api_index.html" class="level3 ">chrome.* APIs</a>
          </li><li class="level3">
                <a href="api_other.html" class="level3 ">Other APIs</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">More</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="faq.html" class="level3 ">FAQ</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/webstore/docs/index.html" class="level3 ">Chrome Web Store</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/apps/docs/developers_guide.html" class="level3 ">Hosted Apps</a>
          </li><li class="level3">
                <a href="themes.html" class="level3 ">Themes</a>
          </li>
          </ul>
        </li>
        </ul>
      </div>
      <div id="gc-pagecontent">

<div id="toc">
  <ol>
    <li >
      <a href="contentSecurityPolicy.html#restrictions"
         data-list-item
         >Default Policy Restrictions</a>
      <ol>
        <li >
          <a href="contentSecurityPolicy.html#JSEval"
             data-list-item
             >Eval and related functions are disabled</a>
        </li>
        <li >
          <a href="contentSecurityPolicy.html#JSExecution"
             data-list-item
             >Inline JavaScript will not be executed</a>
        </li>
        <li >
          <a href="contentSecurityPolicy.html#resourceLoading"
             data-list-item
             >Only local script and and object resources are loaded</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="contentSecurityPolicy.html#relaxing"
         data-list-item
         >Relaxing the default policy</a>
      <ol>
        <li >
          <a href="contentSecurityPolicy.html#relaxing-inline-script"
             data-list-item
             >Inline Script</a>
        </li>
        <li >
          <a href="contentSecurityPolicy.html#relaxing-remote-script"
             data-list-item
             >Remote Script</a>
        </li>
        <li >
          <a href="contentSecurityPolicy.html#relaxing-eval"
             data-list-item
             >Evaluated JavaScript</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="contentSecurityPolicy.html#tightening"
         data-list-item
         >Tightening the default policy</a>
    </li>
  </ol>
</div>

<h1>Content Security Policy (CSP)</h1>


<p>
  In order to mitigate a large class of potential cross-site scripting issues,
  Chrome's extension system has incorporated the general concept of
  <a href="http://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-specification.dev.html">
    <strong>Content Security Policy (CSP)</strong>
  </a>. This introduces some fairly strict policies that will make extensions
  more secure by default, and provides you with the ability to create and
  enforce rules governing the types of content that can be loaded and executed
  by your extensions and applications.
</p>

<p>
  In general, CSP works as a black/whitelisting mechanism for resources loaded
  or executed by your extensions. Defining a reasonable policy for your
  extension enables you to carefully consider the resources that your extension
  requires, and to ask the browser to ensure that those are the only resources
  your extension has access to. These policies provide security over and above
  the <a href="declare_permissions.html">host permissions</a> your extension
  requests; they're an additional layer of protection, not a replacement.
</p>

<p>
  On the web, such a policy is defined via an HTTP header or <code>meta</code>
  element. Inside Chrome's extension system, neither is an appropriate
  mechanism. Instead, an extension's policy is defined via the extension's
  <a href="manifest.html"><code>manifest.json</code></a> file as follows:
</p>

<pre data-filename="manifest.json">
{
  ...,
  "content_security_policy": "[POLICY STRING GOES HERE]"
  ...
}
</pre>

<p class="note">
  For full details regarding CSP's syntax, please take a look at
  <a href="http://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-specification.dev.html#syntax">
    the Content Security Policy specification
  </a>, and the <a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/">
    "An Introduction to Content Security Policy"
  </a> article on HTML5Rocks.
</p>

<h2 id="restrictions">Default Policy Restrictions</h2>

<p>
  Packages that do not define a <a href="manifestVersion.html">
    <code>manifest_version</code>
  </a> have no default content security policy. Those that select
  <code>manifest_version</code> 2, have a default content security policy
  of:
</p>

<pre>script-src 'self'; object-src 'self'</pre>

<p>
  This policy adds security by limiting extensions and applications in three 
  ways:
</p>

<h3 id="JSEval">Eval and related functions are disabled</h3>

<p>Code like the following does not work:</p>

<pre>
alert(eval("foo.bar.baz"));
window.setTimeout("alert('hi')", 10);
window.setInterval("alert('hi')", 10);
new Function("return foo.bar.baz");
</pre>

<p>Evaluating strings of JavaScript like this is a common XSS attack vector.
Instead, you should write code like:

<pre>
alert(foo && foo.bar && foo.bar.baz);
window.setTimeout(function() { alert('hi'); }, 10);
window.setInterval(function() { alert('hi'); }, 10);
function() { return foo && foo.bar && foo.bar.baz };
</pre>

<h3 id="JSExecution">Inline JavaScript will not be executed</h3>

<p>
  Inline JavaScript will not be executed. This restriction bans both inline
 <code>&lt;script&gt;</code> blocks <strong>and</strong> inline event handlers
 (e.g. <code>&lt;button onclick="..."&gt;</code>).
</p>

<p>
  The first restriction wipes out a huge class of cross-site scripting attacks
  by making it impossible for you to accidentally execute script provided by a
  malicious third-party. It does, however, require you to write your code with a
  clean separation between content and behavior (which you should of course do
  anyway, right?). An example might make this clearer. You might try to write a
  <a href="browserAction.html#popups">Browser Action's popup</a> as a single
  <code>popup.html</code> containing:
</p>

<pre data-filename="popup.html">
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Awesome Popup!&lt;/title&gt;
    &lt;script&gt;
      function awesome() {
        // do something awesome!
      }

      function totallyAwesome() {
        // do something TOTALLY awesome!
      }

      function clickHandler(element) {
        setTimeout(<strong>"awesome(); totallyAwesome()"</strong>, 1000);
      }

      function main() {
        // Initialization work goes here.
      }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body onload="main();"&gt;
    &lt;button <strong>onclick="clickHandler(this)"</strong>&gt;
      Click for awesomeness!
    &lt;/button&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
  Three things will need to change in order to make this work the way you expect
  it to:
</p>

<ul>
  <li>
    The <code>clickHandler</code> definition needs to move into an external
    JavaScript file (<code>popup.js</code> would be a good target).
  </li>
  <li>
    <p>The inline event handler definitions must be rewritten in terms of
    <code>addEventListener</code> and extracted into <code>popup.js</code>.</p>
    <p>If you're currently kicking off your program's execution via code like
    <code>&lt;body onload="main();"&gt;</code>, consider replacing it by hooking
    into the document's <code>DOMContentLoaded</code> event, or the window's
    <code>load</code> event, depending on your needs. Below we'll use the
    former, as it generally triggers more quickly.</p>
  </li>
  <li>
    The <code>setTimeout</code> call will need to be rewritten to avoid
    converting the string <code>"awesome(); totallyAwesome()"</code> into
    JavaScript for execution.
  </li>
</ul>

<p>
  Those changes might look something like the following:
</p>

<pre data-filename="popup.js">
function awesome() {
  // Do something awesome!
}

function totallyAwesome() {
  // do something TOTALLY awesome!
}

<strong>function awesomeTask() {
  awesome();
  totallyAwesome();
}</strong>

function clickHandler(e) {
  setTimeout(<strong>awesomeTask</strong>, 1000);
}

function main() {
  // Initialization work goes here.
}

// Add event listeners once the DOM has fully loaded by listening for the
// `DOMContentLoaded` event on the document, and adding your listeners to
// specific elements when it triggers.
<strong>document.addEventListener('DOMContentLoaded', function () {</strong>
  document.querySelector('button').addEventListener('click', clickHandler);
  main();
});
</pre>
<pre data-filename="popup.html">
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Awesome Popup!&lt;/title&gt;
    &lt;script <strong>src="popup.js"</strong>&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button&gt;Click for awesomeness!&lt;/button&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>


<h3 id="resourceLoading">Only local script and and object resources are loaded</h3>

<p>
  Script and object resources can only be loaded from the extension's
  package, not from the web at large. This ensures that your extension only
  executes the code you've specifically approved, preventing an active network
  attacker from maliciously redirecting your request for a resource.
</p>

<p>
  Instead of writing code that depends on jQuery (or any other library) loading
  from an external CDN, consider including the specific version of jQuery in
  your extension package. That is, instead of:
</p>

<pre data-filename="popup.html">
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Awesome Popup!&lt;/title&gt;
    &lt;script src="<strong>http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js</strong>"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button&gt;Click for awesomeness!&lt;/button&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>
  Download the file, include it in your package, and write:
<p>

<pre data-filename="popup.html">
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Awesome Popup!&lt;/title&gt;
    &lt;script src="<strong>jquery.min.js</strong>"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button&gt;Click for awesomeness!&lt;/button&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

<h2 id="relaxing">Relaxing the default policy</h2>

<h3 id="relaxing-inline-script">Inline Script</h3>

<p>
  There is no mechanism for relaxing the restriction against executing inline
  JavaScript. In particular, setting a script policy that includes
  <code>'unsafe-inline'</code> will have no effect.
</p>

<h3 id="relaxing-remote-script">Remote Script</h3>

<p>
  If you have a need for some external JavaScript or object
  resources, you can relax the policy to a limited extent by whitelisting
  secure origins from which scripts should be accepted. We want to ensure that
  executable resources loaded with an extension's elevated permissions are
  exactly the resources you expect, and haven't been replaced by an active
  network attacker. As <a
  href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle
  attacks</a> are both trivial and undetectable over HTTP, those origins will
  not be accepted. Currently, we allow whitelisting origins with the following
  schemes: <code>HTTPS</code>, <code>chrome-extension</code>, and
  <code>chrome-extension-resource</code>.
</p>

<p>
  To ease development, we're also allowing the whitelisting of resources loaded
  over HTTP from servers on your local machine. You may whitelist script and
  object sources on any port of either <code>http://127.0.0.1</code> or
  <code>http://localhost</code>.
</p>

<p class="note">
  The restriction against resources loaded over HTTP applies only to those
  resources which are directly executed. You're still free, for example, to
  make XMLHTTPRequest connections to any origin you like; the default policy
  doesn't restrict <code>connect-src</code> or any of the other CSP directives
  in any way.
</p>

<p>
  A relaxed policy definition which allows script resources to be loaded from
  <code>example.com</code> over HTTPS might look like:
</p>

<pre data-filename="manifest.json">
"content_security_policy": "script-src 'self' https://example.com; object-src 'self'"
</pre>

<p class="note">
  Note that both <code>script-src</code> and <code>object-src</code> are defined
  by the policy. Chrome will not accept a policy that doesn't limit each of
  these values to (at least) <code>'self'</code>.
</p>

<p>
  Making use of Google Analytics is the canonical example for this sort of
  policy definition. It's common enough that we've provided an Analytics
  boilerplate of sorts in the <a href="samples.html#event-tracking-with-google-analytics">Event Tracking
  with Google Analytics</a> sample extension, and a
<a href="tut_analytics.html">brief tutorial</a> that goes into more detail.
</p>

<h3 id="relaxing-eval">Evaluated JavaScript</h3>

<p>
  The policy against <code>eval()</code> and its relatives like
  <code>setTimeout(String)</code>, <code>setInterval(String)</code>, and
  <code>new Function(String)</code> can be relaxed by adding
  <code>'unsafe-eval'</code> to your policy:
</p>

<pre data-filename="manifest.json">
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'"
</pre>

<p>
  However, we strongly recommend against doing this. These functions are
  notorious XSS attack vectors.
</p>

<h2 id="tightening">Tightening the default policy</h2>

<p>
  You may, of course, tighten this policy to whatever extent your extension
  allows in order to increase security at the expense of convenience. To specify
  that your extension can only load resources of <em>any</em> type (images, etc)
  from its own package, for example, a policy of <code>default-src 'self'</code>
  would be appropriate. The <a href="samples.html#mappy">Mappy</a> sample
  extension is a good example of an extension that's been locked down above and
  beyond the defaults.
</p>
      </div>
    </div>
  </body>

  <div id="gc-footer">
    <button class="google-button" id="scroll-to-top">↑</button>
    <button class="google-button" id="send-feedback">Send Feedback</button>
    <div class="text">
      <p>
        Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.
      </p>
      <p>
        ©2013 Google
      </p>
      <script src="../static/js/platform_chooser.js" type="text/javascript"></script>
      <script src="../static/js/popup.js" type="text/javascript"></script>
      <script src="../static/js/prettify.js" type="text/javascript"></script>
      <script src="../static/js/scroll.js" type="text/javascript"></script>
      <script src="../static/js/sidebar.js" type="text/javascript"></script>
      <script src="../static/js/tabs.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++) {
            var preElement = preElements[i];
            preElement.classList.add('prettyprint');
            var datasetFilename = preElement.getAttribute('data-filename');
            if (datasetFilename) {
              var filename = document.createElement('div');
              filename.className = 'filename nocode';
              filename.textContent = datasetFilename;
              preElement.insertBefore(filename, preElement.firstChild);
            }
          }
          prettyPrint();
        })();
      </script>

      <!-- Feedback. -->
      <script type="text/javascript" src="http://www.gstatic.com/feedback/api.js"></script>
      <script type="text/javascript">
        (function() {
         document.getElementById('send-feedback').addEventListener('click', function() {
           userfeedback.api.startFeedback({ productId: 86265 });
         });
        })();
      </script>
    </div>
  </div>
</html>
