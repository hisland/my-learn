<!DOCTYPE html>
<html>
  <head>
    <title>External Content - Google Chrome</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="../static/css/site.css" rel="stylesheet" type="text/css">
    <link href="../static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41980257-1');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="gc-topnav">
      <table><tr>
      <td id="chrome-logo">
        <a href="http://developer.chrome.com/apps/" title="Google Chrome Apps">
          <img src="../static/images/chrome-logo.png" alt=""> chrome
        </a>
        <div id="platform-chooser">
          <button id="platform-chooser-toggle" data-menu="platform-chooser-popup">
            apps &#x25be;&#x202F;
          </button>
          <div id="platform-chooser-popup">
            <button class="apps" data-href="/apps/about_apps.html">apps</button>
            <button class="extensions" data-href="/extensions">extensions</button>
          </div>
        </div>
      </td>
      <td>
        <ul>
          <li>
            <a href="http://developer.chrome.com/apps/samples.html"
               title="Sample Apps (with source code)">Samples</a>
          </li>
          <li>
            <a href="http://groups.google.com/a/chromium.org/group/chromium-apps"
               title="Google Chrome Apps developer forum"
               target="_blank">Group</a>
          </li>
          <li>
            <a href="http://stackoverflow.com/tags/google-chrome-app/info"
               title="[google-chrome-app] tag on Stack Overflow"
               target="_blank">Stack overflow</a>
          </li>
        </ul>
      </td>
      </tr></table>
    </div>
    <div id="gc-topnav-space"></div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
        <li class="level2">
              <span class="level2">Discover</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/about_apps.html" class="level3 ">What Are Chrome Apps?</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Develop</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/first_app.html" class="level3 ">Create Your First App</a>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Tutorials</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                <a class="button level4">
                  <span class="level4">Learn with a Codelab</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab.html" class="level5 ">About this Codelab</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab1_setup.html" class="level5 ">1 - Set Up Development Environment</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab2_basic.html" class="level5 ">2 - Create Basic App</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab3_mvc.html" class="level5 ">3 - Create MVC</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab5_data.html" class="level5 ">4 - Save and Fetch Data</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab6_lifecycle.html" class="level5 ">5 - Manage App Lifecycle</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab7_useridentification.html" class="level5 ">6 - Access User's Data</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab8_webresources.html" class="level5 ">7 - Access Web Resources</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab_10_publishing.html" class="level5 ">8 - Publish App</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">MVC Architecture &amp; Frameworks</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_frameworks.html" class="level5 ">About MVC Architecture</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/angular_framework.html" class="level5 ">Build Apps with AngularJS</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/sencha_framework.html" class="level5 ">Build Apps with Sencha Ext JS</a>
              </li>
              </ul>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Chrome App Concepts</span>
                <div class="toggleIndicator level3 toggled"></div>
              </a>
            <ul toggleable
                class="level3 ">
            <li class="level4">
                <a class="button level4">
                  <span class="level4">The Fundamentals</span>
                  <div class="toggleIndicator level4 toggled"></div>
                </a>
              <ul toggleable
                  class="level4 ">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_architecture.html" class="level5 ">App Architecture</a>
              </li><li class="level5">
                    <a href="app_lifecycle.html" class="level5 ">App Lifecycle</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/offline_apps.html" class="level5 ">Offline First</a>
              </li><li class="level5">
                    <a  class="level5 selected">External Content</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">Security</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/contentSecurityPolicy.html" class="level5 ">Content Security Policy</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">Cloud-Enable Your App</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                  <a class="button level5">
                    <span class="level5">Cloud Messaging</span>
                    <div class="toggleIndicator level5"></div>
                  </a>
                <ul toggleable
                    class="level5 hidden">
                <li class="level6">
                      <a href="http://developer.chrome.com/apps/cloudMessaging.html" class="level6 ">About Cloud Messaging</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/pushMessaging.html" class="level6 ">Client Reference</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/gcm_server.html" class="level6 ">Service Reference</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/gcm_tos.html" class="level6 ">Terms of Service</a>
                </li>
                </ul>
              </li><li class="level5">
                  <a class="button level5">
                    <span class="level5">Cloud Storage</span>
                    <div class="toggleIndicator level5"></div>
                  </a>
                <ul toggleable
                    class="level5 hidden">
                <li class="level6">
                      <a href="http://developer.chrome.com/apps/storage.html" class="level6 ">chrome.storage</a>
                </li>
                </ul>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_identity.html" class="level5 ">User Authentication</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">Store and Retrieve Data</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_storage.html" class="level5 ">Storage APIs</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">Use Low-Level System Services</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_usb.html" class="level5 ">USB</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_serial.html" class="level5 ">Serial</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_network.html" class="level5 ">Network Communications</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4">
                  <span class="level4">Interact with the Host Platform</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable
                  class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/desktop_notifications.html" class="level5 ">Rich Notifications</a>
              </li>
              </ul>
            </li>
            </ul>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Distribute</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="publish_app.html" class="level3 ">Publish Your App</a>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Monetize Your App</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="http://developer.chrome.com/apps/google_wallet.html" class="level4 ">Google Wallet for Digital Goods</a>
            </li>
            </ul>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/analytics.html" class="level3 ">Analytics</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Reference</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/api_index.html" class="level3 ">Chrome Platform APIs</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/tags/webview.html" class="level3 ">Webview Tag</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/api_other.html" class="level3 ">Web APIs</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/manifest.html" class="level3 ">Manifest File Format</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/app_deprecated.html" class="level3 ">Disabled Web Features</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Samples</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/samples.html" class="level3 ">Sample Apps</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Help</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/faq.html" class="level3 ">FAQ</a>
          </li><li class="level3">
                <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-apps" class="level3 ">Google Groups</a>
          </li><li class="level3">
                <a href="http://stackoverflow.com/questions/tagged/google-chrome-app" class="level3 ">Stack Overflow</a>
          </li>
          </ul>
        </li>
        </ul>
      </div>
      <div id="gc-pagecontent">

<div id="toc">
  <ol>
    <li >
      <a href="app_external.html#external"
         data-list-item
         >Referencing external resources</a>
      <ol>
        <li >
          <a href="app_external.html#manifest"
             data-list-item
             >Manifest requirement</a>
        </li>
        <li >
          <a href="app_external.html#cross-origin"
             data-list-item
             >Cross-origin XMLHttpRequest</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="app_external.html#webview"
         data-list-item
         >Embed external web pages</a>
      <ol>
        <li >
          <a href="app_external.html#webview_element"
             data-list-item
             >Add webview element</a>
        </li>
        <li >
          <a href="app_external.html#properties"
             data-list-item
             >Update properties</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="app_external.html#sandboxing"
         data-list-item
         >Sandbox local content</a>
      <ol>
        <li >
          <a href="app_external.html#inline_scripts"
             data-list-item
             >Use inline scripts in sandbox</a>
        </li>
        <li >
          <a href="app_external.html#include_sandbox"
             data-list-item
             >Include sandbox in manifest</a>
        </li>
        <li >
          <a href="app_external.html#opening_sandbox"
             data-list-item
             >Opening a sandboxed page in a window</a>
        </li>
        <li >
          <a href="app_external.html#embedding_sandbox"
             data-list-item
             >Embedding a sandboxed page in an app page</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="app_external.html#postMessage"
         data-list-item
         >Sending messages to sandboxed pages</a>
      <ol>
        <li >
          <a href="app_external.html#post_message"
             data-list-item
             >Post message</a>
        </li>
        <li >
          <a href="app_external.html#listen_message"
             data-list-item
             >Listen for message</a>
        </li>
      </ol>
    </li>
  </ol>
</div>

<h1>External Content</h1>


<p>
The <a href="http://developer.chrome.com/apps/app_architecture.html#security">Chrome Apps security model</a> disallows
external content in iframes and
the use of inline scripting and <code>eval()</code>.
You can override these restrictions,
but your external content must be isolated from the app.
</p>

<p>
Isolated content cannot directly
access the app's data or any of the APIs.
Use cross-origin XMLHttpRequests
and post-messaging to communicate between the event page and sandboxed content
and indirectly access the APIs.
</p>

<p class="note">
<b>API Sample: </b>
Want to play with the code?
Check out the
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/sandbox">sandbox</a> sample.
</p>

<h2 id="external">Referencing external resources</h2>

<p>
The <a href="http://developer.chrome.com/apps/contentSecurityPolicy.html">Content Security Policy</a> used by apps disallows
the use of many kinds of remote URLs, so you can't directly reference external
images, stylesheets, or fonts from an app page. Instead, you can use use
cross-origin XMLHttpRequests to fetch these resources,
and then serve them via <code>blob:</code> URLs.
</p>

<h3 id="manifest">Manifest requirement</h3>

<p>
To be able to do cross-origin XMLHttpRequests, you'll need to add a permission
for the remote URL's host:
</p>

<pre data-filename="manifest.json">
"permissions": [
    "...",
    "https://supersweetdomainbutnotcspfriendly.com/"
  ]
</pre>

<h3 id="cross-origin">Cross-origin XMLHttpRequest</h3>

<p>
Fetch the remote URL into the app and serve its contents as a <code>blob:</code>
URL:
</p>

<pre>
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://supersweetdomainbutnotcspfriendly.com/image.png', true);
xhr.responseType = 'blob';
xhr.onload = function(e) {
  var img = document.createElement('img');
  img.src = window.webkitURL.createObjectURL(this.response);
  document.body.appendChild(img);
};

xhr.send();
</pre>

<p>You may want to <a href="http://developer.chrome.com/apps/offline_apps.html#saving-locally">save</a>
these resources locally, so that they are available offline.</p>

<h2 id="webview">Embed external web pages</h2>

<p class="note">
<b>API Sample: </b>
Want to play with the code? Check out the
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/browser">browser</a>
sample.
</p>

<p>
The <code>webview</code> tag allows you to embed external web content in your
app, for example, a web page. It replaces iframes that point to remote URLs,
which are disabled inside Chrome Apps. Unlike iframes, the
<code>webview</code> tag runs in a separate process. This means that an exploit
inside of it will still be isolated and won't be able to gain elevated
privileges. Further, since its storage (cookies, etc.) is isolated from the app,
there is no way for the web content to access any of the app's data.
</p>

<h3 id="webview_element">Add webview element</h3>

<p>
Your <code>webview</code> element must include the URL to the source content
and specify its dimensions.
</p>

<pre data-filename="browser.html">
&lt;webview src="http://news.google.com/" width="640" height="480">&lt;/webview>
</pre>

<h3 id="properties">Update properties</h3>

<p>
To dynamically change the <code>src</code>, <code>width</code> and
<code>height</code> properties of a <code>webview</code> tag, you can either
set those properties directly on the JavaScript object, or use the
<code>setAttribute</code> DOM function.
</p>

<pre data-filename="browser.js">
document.querySelector('#mywebview').src =
    'http://blog.chromium.org/';
// or
document.querySelector('#mywebview').setAttribute(
    'src', 'http://blog.chromium.org/');
</pre>

<h2 id="sandboxing">Sandbox local content</h2>

<p>
Sandboxing allows specified pages
to be served in a sandboxed, unique origin.
These pages are then exempt from their Content Security Policy.
Sandboxed pages can use iframes, inline scripting,
and <code>eval()</code>.
Check out the manifest field description for
<a href="http://developer.chrome.com/apps/manifest/sandbox.html">sandbox</a>.
</p>

<p>
It's a trade-off though:
sandboxed pages can't use the chrome.* APIs.
If you need to do things like <code>eval()</code>,
go this route to be exempt from CSP,
but you won't be able to use the cool new stuff.
</p>

<h3 id="inline_scripts">Use inline scripts in sandbox</h3>

<p>
Here's a sample sandboxed page
which uses an inline script and <code>eval()</code>:
</p>

<pre data-filename="sandboxed.html">
&lt;html>
  &lt;body>
    &lt;h1>Woot&lt;/h1>
    &lt;script>
      document.write('I am an inline script.&lt;br>');
      eval('document.write(\'I am an eval-ed inline script.\');');
    &lt;/script>
  &lt;/body>
&lt;/html>
</pre>

<h3 id="include_sandbox">Include sandbox in manifest</h3>

<p>
You need to include the <code>sandbox</code> field in the manifest
and list the app pages to be served in a sandbox:
</p>

<pre data-filename="manifest.json">
"sandbox": {
  "pages": ["sandboxed.html"]
}
</pre>

<h3 id="opening_sandbox">Opening a sandboxed page in a window</h3>

<p>
Just like any other app pages,
you can create a window that the sandboxed page opens in.
Here's a sample that creates two windows,
one for the main app window that isn't sandboxed,
and one for the sandboxed page:
</p>

<p class="warning">
NOTE:
<a href="https://code.google.com/p/chromium/issues/detail?id=154662">issue 154662</a>
is a bug when using sandbox pages to create windows.
The effect is that an error "Uncaught TypeError: Cannot call method
'initializeAppWindow' of undefined" is output to the developer console
and that the app.window.create call does not call the callback function
with a window object. However, the sandbox page is created as a new window.
</p>

<pre data-filename="background.js">
chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('window.html', {
    'bounds': {
      'width': 400,
      'height': 400,
      'left': 0,
      'top': 0
    }
  });

  chrome.app.window.create('sandboxed.html', {
    'bounds': {
      'width': 400,
      'height': 400,
      'left': 400,
      'top': 0
    }
  });
});
</pre>

<h3 id="embedding_sandbox">Embedding a sandboxed page in an app page</h3>

<p>Sandboxed pages can also be embedded within another app page
  using an <code>iframe</code>:</p>

<pre data-filename="window.html">
&lt;!DOCTYPE html>
&lt;html>
&lt;head>
&lt;/head>
  &lt;body>
    &lt;p>I am normal app window.&lt;/p>

    &lt;iframe src="sandboxed.html" width="300" height="200">&lt;/iframe>
  &lt;/body>
&lt;/html>
</pre>


<h2 id="postMessage">Sending messages to sandboxed pages</h2>

<p>
There are two parts to sending a message:
you need to post a message from the sender page/window,
and listen for messages on the receiving page/window.
</p>

<h3 id="post_message">Post message</h3>

<p>
You can use <code>postMessage</code> to communicate
between your app and sandboxed content.
Here's a sample background script
that posts a message to the sandboxed page it
opens:
</p>

<pre data-filename="background.js">
var myWin = null;

chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('sandboxed.html', {
    'bounds': {
      'width': 400,
      'height': 400
    }
  }, function(win) {
       myWin = win;
       myWin.contentWindow.postMessage('Just wanted to say hey.', '*');
     });
});
</pre>

<p>
Generally speaking on the web,
you want to specify the exact origin
from where the message is sent.
Chrome Apps have no access
to the unique origin of sandboxed content,
so you can only whitelist all origins
as acceptable origins ('*').
On the receiving end,
you generally want to check the origin;
but since Chrome Apps content is contained,
it isn't necessary.
To find out more,
see <a href="https://developer.mozilla.org/en/DOM/window.postMessage">window.postMessage</a>.
</p>

<h3 id="listen_message">Listen for message</h3>

<p>
Here's a sample message receiver
that gets added to your sandboxed page:
</p>

<pre data-filename="sandboxed.html">
var messageHandler = function(e) {
  console.log('Background script says hello.', e.data);
};

window.addEventListener('message', messageHandler);
</pre>

<p class="backtotop"><a href="app_external.html#top">Back to top</a></p>
      </div>
    </div>
  </body>

  <div id="gc-footer">
    <button class="google-button" id="scroll-to-top">↑</button>
    <button class="google-button" id="send-feedback">Send Feedback</button>
    <div class="text">
      <p>
        Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.
      </p>
      <p>
        ©2013 Google
      </p>
      <script src="../static/js/platform_chooser.js" type="text/javascript"></script>
      <script src="../static/js/popup.js" type="text/javascript"></script>
      <script src="../static/js/prettify.js" type="text/javascript"></script>
      <script src="../static/js/scroll.js" type="text/javascript"></script>
      <script src="../static/js/sidebar.js" type="text/javascript"></script>
      <script src="../static/js/tabs.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++) {
            var preElement = preElements[i];
            preElement.classList.add('prettyprint');
            var datasetFilename = preElement.getAttribute('data-filename');
            if (datasetFilename) {
              var filename = document.createElement('div');
              filename.className = 'filename nocode';
              filename.textContent = datasetFilename;
              preElement.insertBefore(filename, preElement.firstChild);
            }
          }
          prettyPrint();
        })();
      </script>

      <!-- Feedback. -->
      <script type="text/javascript" src="http://www.gstatic.com/feedback/api.js"></script>
      <script type="text/javascript">
        (function() {
         document.getElementById('send-feedback').addEventListener('click', function() {
           userfeedback.api.startFeedback({ productId: 86265 });
         });
        })();
      </script>
    </div>
  </div>
</html>
