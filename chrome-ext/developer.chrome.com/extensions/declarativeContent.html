<!DOCTYPE html>
<html>
  <head>
    <title>chrome.declarativeContent - Google Chrome</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="../static/css/site.css" rel="stylesheet" type="text/css">
    <link href="../static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41980257-1');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="gc-topnav">
      <table><tr>
      <td id="chrome-logo">
        <a href="index.html" title="Google Chrome Extensions">
          <img src="../static/images/chrome-logo.png" alt=""> chrome
        </a>
        <div id="platform-chooser">
          <button id="platform-chooser-toggle" data-menu="platform-chooser-popup">
            extensions &#x25be;&#x202F;
          </button>
          <div id="platform-chooser-popup">
            <button class="apps" data-href="/apps/about_apps.html">apps</button>
            <button class="extensions" data-href="/extensions">extensions</button>
          </div>
        </div>
      </td>
      <td>
        <ul>
          <li>
            <a href="samples.html"
               title="Sample Extensions (with source code)">Samples</a>
          </li>
          <li>
            <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions"
               title="Google Chrome Extensions developer forum"
               target="_blank">Group</a>
          </li>
          <li>
            <a href="http://stackoverflow.com/tags/google-chrome-extension/info"
               title="[google-chrome-extension] tag on Stack Overflow"
               target="_blank">Stack overflow</a>
          </li>
        </ul>
      </td>
      </tr></table>
    </div>
    <div id="gc-topnav-space"></div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
        <li class="level2">
              <a href="getstarted.html" class="level2 ">Getting Started</a>
        </li><li class="level2">
              <a href="overview.html" class="level2 ">Overview</a>
        </li><li class="level2">
              <a href="whats_new.html" class="level2 ">What's New?</a>
        </li><li class="level2">
              <a href="devguide.html" class="level2 ">Developer's Guide</a>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">Browser UI</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="browserAction.html" class="level4 ">Browser Actions</a>
            </li><li class="level4">
                  <a href="contextMenus.html" class="level4 ">Context Menus</a>
            </li><li class="level4">
                  <a href="desktop_notifications.html" class="level4 ">Desktop Notifications</a>
            </li><li class="level4">
                  <a href="omnibox.html" class="level4 ">Omnibox</a>
            </li><li class="level4">
                  <a href="options.html" class="level4 ">Options Pages</a>
            </li><li class="level4">
                  <a href="override.html" class="level4 ">Override Pages</a>
            </li><li class="level4">
                  <a href="pageAction.html" class="level4 ">Page Actions</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Browser Interaction</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="bookmarks.html" class="level4 ">Bookmarks</a>
            </li><li class="level4">
                  <a href="cookies.html" class="level4 ">Cookies</a>
            </li><li class="level4">
                  <a href="devtools.html" class="level4 ">Extending DevTools</a>
            </li><li class="level4">
                  <a href="events.html" class="level4 ">Events</a>
            </li><li class="level4">
                  <a href="history.html" class="level4 ">History</a>
            </li><li class="level4">
                  <a href="management.html" class="level4 ">Management</a>
            </li><li class="level4">
                  <a href="tabs.html" class="level4 ">Tabs</a>
            </li><li class="level4">
                  <a href="windows.html" class="level4 ">Windows</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Implementation</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="a11y.html" class="level4 ">Accessibility</a>
            </li><li class="level4">
                  <a href="event_pages.html" class="level4 ">Event Pages</a>
            </li><li class="level4">
                  <a href="contentSecurityPolicy.html" class="level4 ">Content Security Policy</a>
            </li><li class="level4">
                  <a href="content_scripts.html" class="level4 ">Content Scripts</a>
            </li><li class="level4">
                  <a href="xhr.html" class="level4 ">Cross-Origin XHR</a>
            </li><li class="level4">
                  <a href="i18n.html" class="level4 ">Internationalization</a>
            </li><li class="level4">
                  <a href="messaging.html" class="level4 ">Message Passing</a>
            </li><li class="level4">
                  <a href="permissions.html" class="level4 ">Optional Permissions</a>
            </li><li class="level4">
                  <a href="npapi.html" class="level4 ">NPAPI Plugins</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">Finishing</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="hosting.html" class="level4 ">Hosting</a>
            </li><li class="level4">
                  <a href="external_extensions.html" class="level4 ">Other Deployment Options</a>
            </li>
            </ul>
          </li>
          </ul>
        </li><li class="level2">
              <a href="tutorials.html" class="level2 ">Tutorials</a>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="tut_migration_to_manifest_v2.html" class="level3 ">Manifest V2</a>
          </li><li class="level3">
                <a href="tut_debugging.html" class="level3 ">Debugging</a>
          </li><li class="level3">
                <a href="tut_analytics.html" class="level3 ">Google Analytics</a>
          </li><li class="level3">
                <a href="tut_oauth.html" class="level3 ">OAuth</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Reference</span>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">Formats</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="manifest.html" class="level4 ">Manifest Files</a>
            </li><li class="level4">
                  <a href="match_patterns.html" class="level4 ">Match Patterns</a>
            </li>
            </ul>
          </li><li class="level3">
                <a href="permission_warnings.html" class="level3 ">Permission Warnings</a>
          </li><li class="level3">
                <a href="api_index.html" class="level3 ">chrome.* APIs</a>
          </li><li class="level3">
                <a href="api_other.html" class="level3 ">Other APIs</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">More</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="faq.html" class="level3 ">FAQ</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/webstore/docs/index.html" class="level3 ">Chrome Web Store</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/apps/docs/developers_guide.html" class="level3 ">Hosted Apps</a>
          </li><li class="level3">
                <a href="themes.html" class="level3 ">Themes</a>
          </li>
          </ul>
        </li>
        </ul>
      </div>
      <div id="gc-pagecontent">

<p class="warning">
  This API is experimental. It is only available to Chrome users on the
  <a href="http://www.chromium.org/getting-involved/dev-channel">dev channel</a>.
</p>
<h1>chrome.declarativeContent</h1>
<div id="toc">
  <ol>
    <li >
      <a href="declarativeContent.html#usage"
         data-list-item
         >Usage</a>
    </li>
    <li >
      <a href="declarativeContent.html#rules"
         data-list-item
         >Rules</a>
    </li>
    <li >
      <a href="declarativeContent.html#css-matching"
         data-list-item
         >CSS Matching</a>
    </li>
    <li class="separator">
      <a href="declarativeContent.html#types"
         data-list-item
         >Types</a>
      <ol>
        <li >
          <a href="declarativeContent.html#type-PageStateMatcher"
             data-list-item
             >PageStateMatcher</a>
        </li>
        <li >
          <a href="declarativeContent.html#type-ShowPageAction"
             data-list-item
             >ShowPageAction</a>
        </li>
      </ol>
    </li>
    <li >
      <a href="declarativeContent.html#events"
         data-list-item
         >Events</a>
      <ol>
        <li >
          <a href="declarativeContent.html#event-onPageChanged"
             data-list-item
             >onPageChanged</a>
        </li>
      </ol>
    </li>
  </ol>
</div>

<table class="intro" id="intro">
  <tr>
    <td class="title">Description:</td>
    <td>
        Use the <code>chrome.declarativeContent</code> API to take actions depending on the content of a page, without requiring permission to read the page's content.
                <br>
    </td>
  </tr>
  <tr>
    <td class="title">Availability:</td>
    <td>
        <a href="http://www.chromium.org/getting-involved/dev-channel">Dev</a> channel only.
        <br>
    </td>
  </tr>
  <tr>
    <td class="title">Permissions:</td>
    <td>
        <span class="code">
        "declarativeContent"
                </span>
        <br>
    </td>
  </tr>
  <tr>
    <td class="title">Learn More:</td>
    <td>
        <a href="events.html">
        Declarative Events
                </a>
        <br>
        <a href="activeTab.html">
        activeTab
                </a>
        <br>
    </td>
  </tr>
</table>
<section>
<h2 id="usage">Usage</h2>

<p>
The Declarative Content API allows you to show your extension's
<a href="pageAction.html">page action</a> depending on the URL of a web page and
the CSS selectors its content matches, without needing to take a <a
href="declare_permissions.html#host-permissions">host permission</a> or
inject a <a href="content_scripts.html">content script</a>.  Use the
<a href="activeTab.html">activeTab</a> permission in order to be able
to interact with a page after the user clicks on your page action.
</p>

<p>
If you need more precise control over when your page action appears or
you need to change its appearance to match the current tab before the
user clicks on it, you'll have to keep using the <a href="pageAction.html">pageAction</a> API.
</p>

<h2 id="rules">Rules</h2>

<p>As a <a href="events.html#declarative">declarative API</a>, this
API lets you register rules on the
<code><a href="declarativeContent.html#event-onPageChanged">onPageChanged</a></code> <a href="events.html#type-Event">event</a> object which
take an action (currently just <code><a href="declarativeContent.html#type-ShowPageAction">ShowPageAction</a></code>) when
a set of conditions, represented as a
<code><a href="declarativeContent.html#type-PageStateMatcher">PageStateMatcher</a></code>, are met.
</p>

<p>
The <code><a href="declarativeContent.html#type-PageStateMatcher">PageStateMatcher</a></code> matches web pages if and only
if all listed criteria are met. The following rule would show a page
action for pages on <code>https://www.google.com/</code> when a
password field is present on it:
</p>

<pre>
var rule1 = {
  conditions: [
    new <a href="declarativeContent.html#type-PageStateMatcher">chrome.declarativeContent.PageStateMatcher</a>({
      <a href="declarativeContent.html#property-PageStateMatcher-pageUrl">pageUrl</a>: { <a href="events.html#property-UrlFilter-hostEquals">hostEquals</a>: 'www.google.com', <a href="events.html#property-UrlFilter-schemes">schemes</a>: ['https'] },
      <a href="declarativeContent.html#property-PageStateMatcher-css">css</a>: ["input[type='password']"]
    })
  ],
  actions: [ new <a href="declarativeContent.html#type-ShowPageAction">chrome.declarativeContent.ShowPageAction</a>() ]
};
</pre>

<p class="note">
<strong>Note:</strong> All conditions and actions are created via a constructor
as shown in the example above.
</p>

<p>
In order to also show a page action for sites with a video, you can
add a second condition, as each condition is sufficient to trigger all
specified actions:
</p>
<pre>
var rule2 = {
  conditions: [
    new <a href="declarativeContent.html#type-PageStateMatcher">chrome.declarativeContent.PageStateMatcher</a>({
      <a href="declarativeContent.html#property-PageStateMatcher-pageUrl">pageUrl</a>: { <a href="events.html#property-UrlFilter-hostEquals">hostEquals</a>: 'www.google.com', <a href="events.html#property-UrlFilter-schemes">schemes</a>: ['https'] },
      <a href="declarativeContent.html#property-PageStateMatcher-css">css</a>: ["input[type='password']"]
    })<strong>,
    new <a href="declarativeContent.html#type-PageStateMatcher">chrome.declarativeContent.PageStateMatcher</a>({
      <a href="declarativeContent.html#property-PageStateMatcher-css">css</a>: ["video"]
    })</strong>
  ],
  actions: [ new <a href="declarativeContent.html#type-ShowPageAction">chrome.declarativeContent.ShowPageAction</a>() ]
};
</pre>

<p>
<a href="events.html#addingrules">Added rules</a> are saved across
browser restarts, so register them as follows:
</p>
<pre>
<a href="runtime.html#event-onInstalled">chrome.runtime.onInstalled</a>.addListener(function(details) {
  <a href="declarativeContent.html#event-onPageChanged">chrome.declarativeContent.onPageChanged</a>.<a href="events.html#removingrules">removeRules</a>(undefined, function() {
    <a href="declarativeContent.html#event-onPageChanged">chrome.declarativeContent.onPageChanged</a>.<a href="events.html#addingrules">addRules</a>([rule2]);
  });
});
</pre>

<p class="note">
<strong>Note:</strong> You should always register or unregister rules in bulk
rather than individually because each of these operations recreates internal
data structures.  This re-creation is computationally expensive but facilitates
a faster matching algorithm.
</p>

<p>
Combine the above rule with the <a href="activeTab.html">activeTab</a>
permission to create an extension that doesn't need any install-time
permissions but can invite the user to click its page action on
relevant pages and can run on those pages when the user clicks the
page action.
</p>

<h2 id="css-matching">CSS Matching</h2>

<p><a href="declarativeContent.html#property-PageStateMatcher-css">PageStateMatcher.css</a> conditions must be
<i><a href="http://www.w3.org/TR/selectors4/#compound">compound selectors</a></i>,
meaning that you can't
include <a href="http://www.w3.org/community/webed/wiki/CSS/Selectors#Combinators">combinators</a>
like whitespace or "<code>&gt;</code>" in your selectors.  This helps Chrome
match the selectors more efficiently.</p>

<table>
  <tr><th>Compound Selectors (OK)</th><th>Complex Selectors (Not OK)</th></tr>
  <tr><td><code>a</code></td><td><code>div p</code></td></tr>
  <tr><td><code>iframe.special[src^='http']</code></td><td><code>p>span.highlight</code></td></tr>
  <tr><td><code>ns|*</code></td><td><code>p + ol</code></td></tr>
  <tr><td><code>#abcd:checked</code></td><td><code>p::first-line</code></td></tr>
</table>

<p>CSS conditions only match displayed elements: if an element that matches your
selector is <code>display:none</code> or one of its parent elements
is <code>display:none</code>, it doesn't cause the condition to match.  Elements
styled with <code>visibility:hidden</code>, positioned off-screen, or hidden by
other elements can still make your condition match.</p>
</section>
<section>
<h2 id="api-reference-header" title="">chrome.declarativeContent reference</h2>
<div class="api_reference">
    <h2 id="types">Types</h2>
      <div>
        <h3 id="type-PageStateMatcher">PageStateMatcher</h3>
        <div>
          <dd>Matches the state of a web page by various criteria.</dd>
            <h3 id="PageStateMatcher-properties" class="capitalize" title="">
              properties of <a href="declarativeContent.html#type-PageStateMatcher">PageStateMatcher</a>
            </h3>
            <dd>
              <dl>
                <div>
                  <a name="property-PageStateMatcher-pageUrl"></a>
                  <dl>
                    <dt>
                      <h4 id="property-PageStateMatcher-pageUrl" title="">
                        pageUrl
                        <span class="property">
                          (
                            <span class="optional">optional</span>
                            <a href="events.html#type-UrlFilter">events.UrlFilter</a>
                          )
                        </span>
                      </h4>
                    </dt>
                    <dd>
                      Matches if the condition of the UrlFilter are fulfilled for the top-level URL of the page.
                    </dd>
                  </dl>
                </div><div>
                  <a name="property-PageStateMatcher-css"></a>
                  <dl>
                    <dt>
                      <h4 id="property-PageStateMatcher-css" title="">
                        css
                        <span class="property">
                          (
                            <span class="optional">optional</span>
                            array of string
                          )
                        </span>
                      </h4>
                    </dt>
                    <dd>
                      Matches if all of the CSS selectors in the array match displayed elements in a frame with the same origin as the page's main frame.  All selectors in this array must be <a href="http://www.w3.org/TR/selectors4/#compound">compound selectors</a> to speed up matching.  Note that listing hundreds of CSS selectors or CSS selectors that match hundreds of times per page can still slow down web sites.
                    </dd>
                  </dl>
                </div>
              </dl>
            </dd>
        </div>
      </div>
      <div>
        <h3 id="type-ShowPageAction">ShowPageAction</h3>
        <div>
          <dd>Declarative event action that shows the extension's <a href="pageAction.html">page action</a> while the corresponding conditions are met.  This action can be used without <a href="declare_permissions.html#host-permissions">host permissions</a>, but the extension must have a page action.  If the extension takes the <a href="activeTab.html">activeTab</a> permission, a click on the page action will grant access to the active tab.</dd>
        </div>
      </div>
    <h2 id="events">Events</h2>
      <div>
        <h3 id="event-onPageChanged">onPageChanged</h3>
        <div class="description">
          <p>Provides the <a href="events.html#declarative">Declarative Event API</a>
          consisting of $ref:[events.Event.addRules addRules],
          $ref:[events.Event.removeRules removeRules], and $ref:[events.Event.getRules
          getRules].</p>
          <div class="summary">
            <div class="line">
            <span>chrome.declarativeContent.onPageChanged.addRules</span>(<span>array of <a href="declarativeContent.html#type-Rule">Rule</a> rules</span>, <span class="optional">function callback</span>)
            </div>
            <div class="line">
            <span>chrome.declarativeContent.onPageChanged.removeRules</span>(<span class="optional">array of string ruleIdentifiers</span>, <span class="optional">function callback</span>)
            </div>
            <div class="line">
            <span>chrome.declarativeContent.onPageChanged.getRules</span>(<span class="optional">array of string ruleIdentifiers</span>, <span>function callback</span>)
            </div>
          </div>
            <h4 title="">Supported conditions</h4>
            <ul>
              <div><li><a href="declarativeContent.html#type-PageStateMatcher">PageStateMatcher</a></li></div>
            </ul>
            <h4 title="">Supported actions</h4>
            <ul>
              <div><li><a href="declarativeContent.html#type-ShowPageAction">ShowPageAction</a></li></div>
            </ul>
        </div>
      </div>
</div>
</section>
      </div>
    </div>
  </body>

  <div id="gc-footer">
    <button class="google-button" id="scroll-to-top">↑</button>
    <button class="google-button" id="send-feedback">Send Feedback</button>
    <div class="text">
      <p>
        Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.
      </p>
      <p>
        ©2013 Google
      </p>
      <script src="../static/js/platform_chooser.js" type="text/javascript"></script>
      <script src="../static/js/popup.js" type="text/javascript"></script>
      <script src="../static/js/prettify.js" type="text/javascript"></script>
      <script src="../static/js/scroll.js" type="text/javascript"></script>
      <script src="../static/js/sidebar.js" type="text/javascript"></script>
      <script src="../static/js/tabs.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++) {
            var preElement = preElements[i];
            preElement.classList.add('prettyprint');
            var datasetFilename = preElement.getAttribute('data-filename');
            if (datasetFilename) {
              var filename = document.createElement('div');
              filename.className = 'filename nocode';
              filename.textContent = datasetFilename;
              preElement.insertBefore(filename, preElement.firstChild);
            }
          }
          prettyPrint();
        })();
      </script>

      <!-- Feedback. -->
      <script type="text/javascript" src="http://www.gstatic.com/feedback/api.js"></script>
      <script type="text/javascript">
        (function() {
         document.getElementById('send-feedback').addEventListener('click', function() {
           userfeedback.api.startFeedback({ productId: 86265 });
         });
        })();
      </script>
    </div>
  </div>
</html>
