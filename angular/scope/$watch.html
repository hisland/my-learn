<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hello World!</title>
</head>
<body ng-app="app">
  <script src="../angular.js"></script>
  <script>
    angular.module('app', [])
    .run(function($rootScope, $timeout) {
      // ref可以被调用来清除这个watch
      var ref = $rootScope.$watch('god', function(v){ //本来会初始化调用一次, 因为下面立即修改了, 所以这里不会执行
        console.log('god: ', v);
      });

      $rootScope.god = 33; //下面这个立刻执行, 有缓冲, 所以这个结果不会出现
      $rootScope.god = 44;

      // 延迟一点就可以了
      $timeout(function(){
        $rootScope.god = 'please';
      }, 100);
      $timeout(function(){
        $rootScope.god = 'aha';
      }, 200);
      $timeout(function(){
        console.log('clear watch');
        ref();
      }, 300);
      $timeout(function(){
        $rootScope.god = 'no watching';
      }, 400);

      // 这个会随时执行 $digest() is called
      $rootScope.$watch(function(){
        console.log('fired every time: ', arguments);
      });


      // test的改变会让这个按 1,2,1 执行, 其它改变会执行1次1
      $rootScope.$watch(function(scope){
        console.log('fired', arguments);
        return scope.$eval('test');
      }, function(v){
        console.log('in test:', arguments);
      });
      $timeout(function(){
        $rootScope.test = 'this is';
      }, 100);
      $timeout(function(){
        $rootScope.test = 'that';
      }, 200);
      // 其它改变会执行1次1
      $timeout(function(){
        $rootScope.tt = 'asd';
      }, 300);

      // 这个会随时执行 $digest() is called
      $rootScope.$watch('a.b', function(v){
        console.log('a.b: ', v);
      });
      $rootScope.a = {b: 1};

    });
  </script>
</body>
</html>
